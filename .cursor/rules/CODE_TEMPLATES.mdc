---
alwaysApply: true
---

# Laravel React SPA - Code Templates & Feature Development Guide

This guide provides comprehensive templates and best practices for adding new features to this Laravel + React + React Router application with Effect-based data loading.

---

## üìã Feature Development Workflow

### 1. Planning Phase
- Define the feature requirements and user stories
- Identify required database changes
- Plan the API endpoints and data flow
- Consider authentication/authorization needs

### 2. Implementation Order
1. **Database & Models** (migrations, Eloquent models)
2. **Data Layer** (Data models, Props, Requests)
3. **Business Logic** (Actions)
4. **API Routes** (routes/api.php)
5. **Frontend** (React components with Effect-based loading)
6. **Routing** (React Router routes)
7. **Testing** (Feature & Browser tests)

---

## üõ†Ô∏è Core Components

### 1. API Routes

**File**: `routes/api.php`

This React SPA uses API-first architecture with JSON responses. Routes are organized in the `api.php` file and are prefixed with `/api/`.

```php
<?php

use App\Actions\Features\ShowFeatures;
use App\Actions\Features\CreateFeature;
use App\Actions\Features\ShowFeature;
use App\Actions\Features\UpdateFeature;
use App\Actions\Features\DeleteFeature;
use Illuminate\Support\Facades\Route;

// Public routes (no authentication required)
Route::get('/public-features', App\Actions\Features\ShowPublicFeatures::class)->name('api.public-features');

// Authenticated routes (require login via Sanctum)
Route::middleware('auth:sanctum')->group(function (): void {
    // Index/List data
    Route::get('/features', ShowFeatures::class)->name('api.features.index');

    // Create new item
    Route::post('/features', CreateFeature::class)->name('api.features.store');

    // Show single item data
    Route::get('/features/{feature}', ShowFeature::class)->name('api.features.show');

    // Update item
    Route::put('/features/{feature}', UpdateFeature::class)->name('api.features.update');

    // Delete item
    Route::delete('/features/{feature}', DeleteFeature::class)->name('api.features.destroy');
});
```

**Key Characteristics**:
- Routes return JSON data consumed by React components
- Use `auth:sanctum` middleware for API authentication
- Route names prefixed with `api.`
- Frontend routing handled by React Router (no "create" or "edit" API routes)
- Actions return structured data for Effect-based loading

---

### 2. Action Classes

#### Show/Index Action
**File**: `app/Actions/Features/ShowFeatures.php`

```php
<?php

declare(strict_types=1);

namespace App\Actions\Features;

use App\Data\Models\FeatureData;
use App\Data\Response\FeaturesResponse;
use App\Models\Feature;
use Illuminate\Http\JsonResponse;
use Illuminate\Http\Request;

class ShowFeatures
{
    /**
     * Display the features list.
     */
    public function __invoke(Request $request): JsonResponse
    {
        $user = $request->user();

        $features = Feature::where('user_id', $user->id)
            ->with(['relationships']) // Eager load to prevent N+1 queries
            ->orderBy('created_at', 'desc')
            ->get();

        return response()->json(FeaturesResponse::from([
            'features' => FeatureData::collect($features),
        ]));
    }
}
```

#### Create/Store Action
**File**: `app/Actions/Features/CreateFeature.php`

```php
<?php

declare(strict_types=1);

namespace App\Actions\Features;

use App\Data\Requests\CreateFeatureRequest;
use App\Models\Feature;
use Illuminate\Http\JsonResponse;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class CreateFeature
{
    /**
     * Create a new feature.
     */
    public function __invoke(CreateFeatureRequest $data, Request $request): JsonResponse
    {
        $user = $request->user();

        $feature = Feature::create([
            'user_id' => $user->id,
            'name' => $data->name,
            'description' => $data->description,
            // Add other fields as needed
        ]);

        return response()->json([
            'message' => 'Feature created successfully',
            'feature' => FeatureData::from($feature),
        ], 201);
    }
}
```

---

### 3. Data Models

**File**: `app/Data/Models/FeatureData.php`

```php
<?php

declare(strict_types=1);

namespace App\Data\Models;

use Illuminate\Support\Carbon;
use Illuminate\Support\Collection;
use Spatie\LaravelData\Attributes\AutoWhenLoadedLazy;
use Spatie\LaravelData\Data;
use Spatie\LaravelData\Lazy;

class FeatureData extends Data
{
    public function __construct(
        public string $id,
        public string $user_id,
        public string $name,
        public string|null $description,
        public Carbon|null $created_at,
        public Carbon|null $updated_at,

        // Lazy-loaded relationships (only included when explicitly loaded)
        /** @var UserData $user */
        #[AutoWhenLoadedLazy]
        public Lazy|UserData $user,

        // Collection relationships
        /** @var Collection<array-key,RelatedFeatureData> $related_features */
        #[AutoWhenLoadedLazy('relatedFeatures')]
        public Collection|Lazy $related_features,
    ) {}
}
```

---

### 4. Response Classes

**File**: `app/Data/Response/FeaturesResponse.php`

```php
<?php

declare(strict_types=1);

namespace App\Data\Response;

use App\Data\Models\FeatureData;
use Illuminate\Support\Collection;
use Spatie\LaravelData\Data;

class FeaturesResponse extends Data
{
    public function __construct(
        /** @var Collection<array-key,FeatureData> $features */
        public Collection $features,
    ) {}
}
```

**For Single Item Response**:
```php
<?php

declare(strict_types=1);

namespace App\Data\Response;

use App\Data\Models\FeatureData;
use Spatie\LaravelData\Data;

class FeatureResponse extends Data
{
    public function __construct(
        public FeatureData $feature,
    ) {}
}
```

**For Paginated Data**:
```php
<?php

declare(strict_types=1);

namespace App\Data\Response;

use App\Data\Models\FeatureData;
use Illuminate\Pagination\LengthAwarePaginator;
use Spatie\LaravelData\Data;

class PaginatedFeaturesResponse extends Data
{
    public function __construct(
        /** @var LengthAwarePaginator<FeatureData> $features */
        public LengthAwarePaginator $features,
    ) {}
}
```

---

### 5. Request Validation Classes

**File**: `app/Data/Requests/CreateFeatureRequest.php`

```php
<?php

declare(strict_types=1);

namespace App\Data\Requests;

use Spatie\LaravelData\Attributes\Validation\Required;
use Spatie\LaravelData\Attributes\Validation\StringType;
use Spatie\LaravelData\Attributes\Validation\Max;
use Spatie\LaravelData\Attributes\Validation\Min;
use Spatie\LaravelData\Attributes\Validation\Email;
use Spatie\LaravelData\Attributes\Validation\BooleanType;
use Spatie\LaravelData\Data;

class CreateFeatureRequest extends Data
{
    public function __construct(
        #[Required]
        #[StringType]
        #[Min(3)]
        #[Max(255)]
        public string $name,

        #[StringType]
        #[Max(1000)]
        public string|null $description = null,

        #[Email]
        public string|null $contact_email = null,

        #[BooleanType]
        public bool $is_active = true,
    ) {}
}
```

**Common Validation Rules**:
- `#[Required]` - Field must be present
- `#[StringType]` - Must be a string
- `#[IntegerType]` - Must be an integer
- `#[BooleanType]` - Must be a boolean
- `#[Email]` - Must be valid email format
- `#[Max(255)]` - Maximum length/value
- `#[Min(3)]` - Minimum length/value
- `#[Unique('table,column')]` - Must be unique in database
- `#[Exists('table,column')]` - Must exist in database

---

### 6. Eloquent Models

**File**: `app/Models/Feature.php`

```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\Concerns\HasUuids;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Notifications\Notifiable;

/**
 * Feature model representing user-created features.
 *
 * @property string $id
 * @property string $user_id
 * @property string $name
 * @property string|null $description
 * @property Carbon|null $created_at
 * @property Carbon|null $updated_at
 * @property-read User $user
 * @property-read Collection<array-key,RelatedFeature> $related_features
 */
class Feature extends Model
{
    /** @use HasFactory<\Database\Factories\FeatureFactory> */
    use HasFactory, HasUuids, Notifiable;

    protected $fillable = [
        'user_id',
        'name',
        'description',
        // Add other fillable fields
    ];

    /**
     * Get the attributes that should be cast.
     */
    protected function casts(): array
    {
        return [
            'is_active' => 'boolean',
            'created_at' => 'datetime',
            'updated_at' => 'datetime',
        ];
    }

    // Relationships
    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }

    public function relatedFeatures(): HasMany
    {
        return $this->hasMany(RelatedFeature::class);
    }
}
```

---

## ‚öõÔ∏è Frontend Templates

### React Page Component with Data Loader
**File**: `resources/js/features/features/FeaturesPage.tsx`

```tsx
import { Link, useLoaderData } from 'react-router-dom';
import { Button } from '@/components/ui/Button';
import { FeaturesResponse } from '@/types/effect-schemas';

export function FeaturesPage() {
    const { features } = useLoaderData<FeaturesResponse>();

    return (
        <div className="max-w-4xl mx-auto">
            <div className="flex justify-between items-center mb-8">
                <h1 className="text-3xl font-bold">My Features</h1>
                <Link to="/features/create">
                    <Button>Create Feature</Button>
                </Link>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {features.map((feature) => (
                    <div key={feature.id} className="bg-white rounded-lg shadow-md p-6">
                        <h2 className="text-xl font-semibold mb-2">
                            <Link
                                to={`/features/${feature.id}`}
                                className="hover:text-blue-600"
                            >
                                {feature.name}
                            </Link>
                        </h2>

                        {feature.description && (
                            <p className="text-gray-600 mb-4">{feature.description}</p>
                        )}

                        <div className="flex justify-between items-center text-sm text-gray-500">
                            <span>{new Date(feature.created_at).toLocaleDateString()}</span>
                            <Link
                                to={`/features/${feature.id}/edit`}
                                className="text-blue-500 hover:text-blue-700"
                            >
                                Edit
                            </Link>
                        </div>
                    </div>
                ))}

                {features.length === 0 && (
                    <div className="col-span-full text-center py-12">
                        <p className="text-gray-500 mb-4">No features yet.</p>
                        <Link to="/features/create">
                            <Button variant="outline">Create your first feature</Button>
                        </Link>
                    </div>
                )}
            </div>
        </div>
    );
}
```

### React Router Integration
**File**: `resources/js/router.tsx`

```typescript
import { createBrowserRouter } from 'react-router-dom';
import { ApiClient } from '@/lib/apiClientSingleton';

export async function tasksLoader() {
    const result = await ApiClient.getTasks();
    if (result._tag === 'Success') {
        return result.data;
    }
    throw new Error(result.message);
}

export const router = createBrowserRouter([
    {
        path: '/tasks',
        element: <TasksPage />,
        loader: tasksLoader,
        errorElement: <ErrorPage />,
    },
    {
        path: '/tasks/create',
        element: <CreateTaskPage />,
    },
]);
```

---

## üìö Complete Feature Example: Task Management

### Step-by-Step Implementation

#### 1. Migration
```php
// database/migrations/xxxx_create_tasks_table.php
Schema::create('tasks', function (Blueprint $table) {
    $table->uuid('id')->primary();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->string('title');
    $table->text('description')->nullable();
    $table->boolean('is_completed')->default(false);
    $table->timestamp('due_date')->nullable();
    $table->timestampsTz();
});
```

#### 2. Model
```php
// app/Models/Task.php
class Task extends Model
{
    use HasFactory, HasUuids;

    protected $fillable = [
        'user_id',
        'title',
        'description',
        'is_completed',
        'due_date',
    ];

    protected function casts(): array
    {
        return [
            'is_completed' => 'boolean',
            'due_date' => 'datetime',
        ];
    }
}
```

#### 3. Data Classes
```php
// app/Data/Models/TaskData.php (Transformed to TypeScript automatically)
class TaskData extends Data
{
    public function __construct(
        public string $id,
        public string $user_id,
        public string $title,
        public string|null $description,
        public bool $is_completed,
        public string|null $due_date,
        public string $created_at,
        public string $updated_at,
    ) {}
}
```

#### 4. Actions
```php
// app/Actions/Tasks/ShowTasks.php
class ShowTasks
{
    public function __invoke(Request $request): JsonResponse
    {
        $tasks = Task::where('user_id', $request->user()->id)->get();

        return response()->json(TasksResponse::from([
            'tasks' => TaskData::collect($tasks),
        ]));
    }
}
```

#### 5. API Routes
```php
// routes/api.php
Route::middleware('auth:sanctum')->group(function (): void {
    Route::get('/tasks', ShowTasks::class)->name('api.tasks.index');
    Route::post('/tasks', CreateTask::class)->name('api.tasks.store');
});
```

#### 6. Effect-Based ApiClient Implementation
**File**: `resources/js/lib/apiClientSingleton.ts`

```typescript
import {
    FetchHttpClient,
    HttpApi,
    HttpApiClient,
    HttpApiEndpoint,
    HttpApiGroup,
} from '@effect/platform';
import { Effect } from 'effect';
import {
    TasksResponseSchema,
    TaskSchema,
    CreateTaskRequestSchema,
} from '@/types/effect-schemas';

// Define the API group manually
const tasksGroup = HttpApiGroup.make('tasks')
    .add(
        HttpApiEndpoint.get('index', '/api/tasks')
            .addSuccess(TasksResponseSchema),
    )
    .add(
        HttpApiEndpoint.post('store', '/api/tasks')
            .setPayload(CreateTaskRequestSchema)
            .addSuccess(TaskSchema),
    );

// Register in the main API definition
export const Api = HttpApi.make('BackendApi')
    .add(tasksGroup);

const baseClient = HttpApiClient.make(Api, { baseUrl: '' });

class ApiClientSingleton {
    getTasks() {
        return Effect.runPromise(
            Effect.gen(function* () {
                const client = yield* baseClient;
                return yield* client.tasks.index().pipe(
                    Effect.map((data) => ({ _tag: 'Success' as const, data })),
                    Effect.catchAll((e) => Effect.succeed({
                        _tag: 'FatalError' as const,
                        message: JSON.stringify(e),
                    })),
                );
            }).pipe(Effect.provide(FetchHttpClient.layer))
        );
    }
}

export const ApiClient = new ApiClientSingleton();
```

---

## ‚úÖ Feature Development Checklist

- [ ] **Planning**: Define requirements and user stories
- [ ] **Database**: Create migration and update model
- [ ] **Data Layer**: Create Data models and Request classes
- [ ] **Business Logic**: Implement Action classes
- [ ] **Routing**: Add routes to `routes/api.php`
- [ ] **Frontend**: Update `ApiClientSingleton` and create React components
- [ ] **Testing**: Write Pest feature and browser tests

---

## üéØ TypeScript Types in Effect-Based Architecture

### Effect Schema Types (Auto-generated)
```typescript
// Schemas are auto-generated from Laravel Data classes via Spatie TypeScript Transformer
// Located in: resources/js/types/effect-schemas.ts
export const FeatureSchema = Schema.Struct({
    id: Schema.String,
    name: Schema.String,
    description: Schema.Union(Schema.String, Schema.Null),
    created_at: Schema.String,
});

// Types are derived from schemas for type safety
export type Feature = Schema.Schema.Type<typeof FeatureSchema>;
```

---

## üîß HttpApiClient Architecture

### Overview
This application uses `@effect/platform`'s `HttpApiClient` to provide type-safe API calls. The API definition is manually constructed in `resources/js/lib/apiClientSingleton.ts`, leveraging schemas generated from PHP Data classes.

### Schema Generation
Schemas are automatically generated from your Laravel Data classes and provide runtime validation via `effect/Schema`. Generation is handled by the Spatie TypeScript Transformer with custom collectors/transformers for Effect.

---

## üêõ Debugging Effect-Based Architecture

### Effect Debugging
- Use Effect's logging capabilities:
```typescript
import { Logger, LogLevel } from 'effect';

const myEffect = Effect.gen(function* () {
    yield* Effect.logDebug('Starting operation...');
    // ... logic
}).pipe(
    Logger.withMinimumLogLevel(LogLevel.Debug)
);
```
